<!DOCTYPE html>
<html>
  <head>
    <title>AR Proyecto - Audio Fantasma</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      renderer="logarithmicDepthBuffer: true;"
      vr-mode-ui="enabled: false"
      gesture-detector
      id="scene"
    >
      
      <a-assets>
        <a-asset-item id="modelo3d" src="./tumodelo.glb"></a-asset-item>
        
        <video 
            id="videoFantasma" 
            src="./video_o_musica.mp4" 
            preload="auto" 
            response-type="arraybuffer" 
            loop 
            crossorigin 
            webkit-playsinline 
            playsinline>
        </video>
      </a-assets>

      <a-marker
        type="pattern"
        url="./tumarcador.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
      >
        <a-entity
          id="bowser-model"
          gltf-model="#modelo3d"
          position="0 0 0"
          scale="0.5 0.5 0.5"
          class="clickable"
          gesture-handler
        >
        </a-entity>
        
        </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      var video = document.getElementById("videoFantasma");
      var marker = document.getElementById("markerA");

      // Cuando aparece el marcador
      marker.addEventListener("markerFound", function () {
          console.log("Marcador detectado: Reproduciendo sonido...");
          video.play();
      });

      // Cuando se va el marcador
      marker.addEventListener("markerLost", function () {
          console.log("Marcador perdido: Pausando...");
          video.pause();
          // video.currentTime = 0; // Descomenta esto si quieres que reinicie siempre
      });
      
      // SOLUCIÓN PARA MOVILES:
      // Si el navegador bloquea el sonido, este código lo desbloquea
      // apenas toques la pantalla para rotar la figura.
      window.addEventListener('click', function () {
          video.play();
      });
    </script>
  </body>
</html>
